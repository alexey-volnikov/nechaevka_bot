# nechaevka_bot

Минимальный мониторинговый бот для сообщества ВКонтакте. Скрипт подключается к Long Poll API, считывает события и показывает их в простом локальном дашборде без отправки сообщений от имени сообщества. Подходит, чтобы безопасно понять, какие данные доступны боту в чате и в сообществе.

> Главное правило: бот ничего не отправляет в чаты и используется только для чтения. Токен хранится локально в `.env`, этот файл не попадает в репозиторий. Все шаги расписаны для начинающих, чтобы можно было повторить в VS Code на Windows (в том числе через Docker Desktop или WSL, если хотите изолировать окружение).

## Что умеет
- Подключается к Long Poll от имени сообщества и фиксирует входящие события.
- Не отправляет никаких сообщений, только читает и пишет события в лог.
- Сохраняет последние полученные сообщения (ID отправителя, peer_id, текст) для просмотра.
- Показывает базовую информацию о сообществе (`description`, `members_count`, контакты).
- Снимает список доступных диалогов и чатов без взаимодействия с ними.
- Выдает статистику через локальный Flask-дейшборд (`/` и `/stats`).

## Подготовка окружения (с нуля)
1. **Установите Python 3.10+**. На Windows удобнее скачать с https://www.python.org/downloads/ и поставить галочку «Add Python to PATH».
2. **Скачайте проект** в папку, где работает VS Code (кнопка Code → Download ZIP или `git clone` если git уже стоит).
3. **Создайте виртуальное окружение**, чтобы зависимости не смешивались с системой:
   ```bash
   python -m venv .venv
   .venv\Scripts\activate  # Windows (PowerShell) — можно запускать из терминала VS Code
   # source .venv/bin/activate  # Если вы в WSL или Linux
   ```
4. **Установите зависимости в активированное окружение**:
   ```bash
   pip install -r requirements.txt
   ```
5. **Создайте собственный `.env`, не коммитя его в git**:
   - Скопируйте пример: `copy .env.example .env` (Windows PowerShell) или `cp .env.example .env` (WSL/Linux).
   - Откройте `.env` в VS Code и заполните без кавычек:
     ```
     VK_GROUP_TOKEN=vk1.a.пример_длинного_токена
     VK_GROUP_ID=123456
     PORT=8000
     ```
   - **VK_GROUP_TOKEN** — токен с правами «Сообщения сообщества». Получить можно в настройках сообщества → Разработка → Создать ключ. Токен хранится только у вас на диске.
   - **VK_GROUP_ID** — числовой ID без `club`/`public`. Если адрес `https://vk.com/club123456`, то в `.env` пишем `123456`.
   - Файл `.env` уже добавлен в `.gitignore`, поэтому даже при `git status` он не попадет в коммиты. Если используете GitHub, убедитесь, что случайно не копируете содержимое токена в сообщения или описание коммитов.

## Запуск
1. Активируйте виртуальное окружение (если неактивно) и выполните:
   ```bash
   python app.py
   ```
2. Держите это окно терминала открытым: в нем будут логи и ошибки, а сам сервер работает пока окно не закрыто.
3. В логах появится сообщение о запуске дашборда. Откройте браузер на `http://127.0.0.1:8000`.
   - `/` — обзор: краткое описание, сведения о сообществе и список последних диалогов.
   - `/stats` — счетчики событий, последние сообщения (ID отправителя, peer_id, текст) и ошибки, если были.
4. Если запускать двойным кликом по `app.py` в Windows и появляются/исчезают окна: лучше открыть VS Code → встроенный Terminal → команда выше. Если ошибка все же случилась, окно теперь не закроется мгновенно, и можно прочитать сообщение.

### Частые причины «сервер не открывается»
- В `.env` не заполнены `VK_GROUP_TOKEN` или `VK_GROUP_ID`: скрипт упадет с сообщением в консоли.
- Порт `8000` занят другим приложением: пропишите в `.env` `PORT=8001` (или любой свободный) и перезапустите.
- Файрвол Windows блокирует входящие соединения: подтвердите запрос или добавьте исключение для `python.exe`.
- Нет интернета или VK API недоступен: дашборд запустится, но данные сообщества/диалогов будут пустыми; в логах появится предупреждение.

## Что можно посмотреть
- В логах увидите входящие сообщения с указанием peer_id и текста.
- На `/stats` — количество событий, сообщений, приглашений/удалений из чатов и последние тексты.
- На `/` — описание сообщества, число участников, контакты (если заданы), список доступных диалогов.

## Потенциал
- Добавить фильтры или сохранение событий в базу данных для дальнейшей аналитики.
- Визуализировать статистику (графики) через любой frontend или n8n, читая JSON с `/stats`.
- Подключить webhooks для уведомлений без отправки сообщений от имени бота.

## Замечания по безопасности
- Не храните боевой токен в репозитории: используйте `.env` (в репо лежит только `.env.example`).
- Скрипт принципиально не вызывает методы отправки сообщений, чтобы не нарушать правило «бот не пишет в чаты».
- Для Docker можно собрать простой образ, но на Windows удобнее запустить через VS Code и локальный Python.
- Проверяйте перед `git add`, что `.env` не добавился в staged-файлы (`git status` покажет зелёным, если вдруг добавили).
